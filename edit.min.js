const textXY=document.getElementById("demo"),dothings=document.getElementById("dothings"),wdots=document.getElementById("wdots"),playing=document.getElementById("playing"),mainTitle=document.getElementById("mainTitle");for(var marker,map,decP=5,initX=0,initY=0,ixy=0,nowX=0,nowY=0,moving=1,circles=$(".circle"),polygons=$(".polygon"),audioObjs=$("audio"),i=0;i<audioObjs.length;++i)audioObjs[i].id="audio"+i,audioObjs[i].pause(),audioObjs[i].volume=0,audioObjs[i].controls=!0;var shapes=[];function startGetLocation(){circles.each(function(){var t=$(this).attr("coord").split(",")[0],o=$(this).attr("coord").split(",")[1],a=$(this).attr("size"),n=$(this).children("audio")[0],e=$(this).attr("id");playCircle(t,o,a,n,e)}),polygons.each(function(){var t=$(this).attr("coord"),o=$(this).children("audio")[0],a=$(this).attr("id");playPolygon(t,o,a)}),dowdots(),0==ixy&&(initX=44.483334,initY=11.35375,map=L.map("map").setView([initX,initY],18),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map),marker=L.marker([initX,initY]).addTo(map),doCircleMap(),doPolygonMap(),ixy+=1),nowX=44.483334,nowY=44.483334,map.on("mousemove",function(t){doAudioThings(nowX=t.latlng.lat.toFixed(decP),nowY=t.latlng.lng.toFixed(decP)),moving=0}),map.on("click",function(t){var o=t.latlng.lat.toFixed(decP)+", "+t.latlng.lng.toFixed(decP);navigator.clipboard.writeText(o),alert(o)})}function doAudioThings(t,o){markerXY=L.latLng(t,o),marker.setLatLng(markerXY),textXY.innerHTML="ACTUAL POSITION: "+t+" , "+o+"<br>STARTING POINT: "+initX+" , "+initY+"<br>distance from STARTING POINT: "+measure(initX,initY,t,o)+"m",dothings.innerHTML="Now Walk Around And Listen",circles.each(function(){var t=$(this).attr("coord").split(",")[0],o=$(this).attr("coord").split(",")[1],a=$(this).attr("size"),n=$(this).children("audio")[0],e=$(this).attr("id");playCircle(t,o,a,n,e)}),polygons.each(function(){var t=$(this).attr("coord"),o=$(this).children("audio")[0],a=$(this).attr("id");playPolygon(t,o,a)})}function decVolume(t,o){if("playing"!==t.classList[0]){var a=Math.round(100*t.volume);a-=1,t.volume=(Math.round(a)/100).toFixed(2),setTimeout(function(){a>1?decVolume(t):(t.volume=0,t.pause(),t.currentTime=0)},100)}}function addVolume(t,o){if("playing"==t.classList[0]){var a=Math.round(100*t.volume);a+=1,t.volume=(Math.round(a)/100).toFixed(2),setTimeout(function(){a<99&&addVolume(t)},100)}}function playCircle(t,o,a,n,e){var s=Number(measure(nowX,nowY,t,o));s<=a&&(n.classList,n.paused&&(n.play(),playing.innerHTML=e+" playing audio "+s+" from "+n.id),n.volume<1&&"playing"!==n.classList[0]&&(n.classList.add("playing"),addVolume(n))),s>a&&!n.paused&&setTimeout(function(){(s=Number(measure(nowX,nowY,t,o)))>a&&(n.classList,n.paused||"playing"!=n.classList[0]||(n.classList.remove("playing"),playing.innerHTML=e+" pause audio "+s+" from "+n.id,decVolume(n)))},2e3)}function playPolygon(t,o,a){var n=[],e=JSON.parse(t);n.push(nowX),n.push(nowY),rayCasting(n,e)&&(o.paused&&(o.classList,o.play(),playing.innerHTML=a+" playing audio  from "+o.id),o.volume<1&&"playing"!==o.classList[0]&&(o.classList.add("playing"),addVolume(o))),rayCasting(n,e)||o.paused||setTimeout(function(){var n=[],e=JSON.parse(t);n.push(nowX),n.push(nowY),rayCasting(n,e)||(o.classList,o.paused||"playing"!=o.classList[0]||(o.classList.remove("playing"),playing.innerHTML=a+" pause audio  from "+o.id,decVolume(o)))},2e3)}function measure(t,o,a,n){var e=a*Math.PI/180-t*Math.PI/180,s=n*Math.PI/180-o*Math.PI/180,r=Math.sin(e/2)*Math.sin(e/2)+Math.cos(t*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return(1e3*(6378.137*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))))).toFixed(2)}function rayCasting(t,o){let a=o.length,n=!1,e=t[0],s=t[1],r,l,d,c;r=o[a-1][0],d=o[a-1][1];for(var u=0;u<a;++u)l=o[u][0],s<d!=s<(c=o[u][1])&&e<(l-r)*(s-d)/(c-d)+r&&(n=!n),r=l,d=c;return n}function doCircleMap(){var t=[];circles.each(function(){var o=$(this).attr("coord").split(",")[0],a=$(this).attr("coord").split(",")[1],n=$(this).attr("size");$(this).children("audio")[0],$(this).attr("id");var e=$(this).parents(".zone").attr("color");let s=circles.length;for(var r=0;r<s;++r)t[r]=L.circle([o,a],{color:e,fillColor:e,fillOpacity:.1,radius:n}).addTo(map)})}function doPolygonMap(){var t=[];polygons.each(function(){var o=$(this).attr("coord");$(this).children("audio")[0],$(this).attr("id");let a=polygons.length;for(var n=$(this).parents(".zone").attr("color"),e=0;e<a;++e){var s=JSON.parse(o);t[e]=L.polygon([s],{color:n,fillColor:n,fillOpacity:.1}).addTo(map)}})}function dowdots(){var t="";setInterval(function(){wdots.innerHTML=t,(t+=".").length>3&&(t="")},500)}setInterval(function(){moving=1},100);